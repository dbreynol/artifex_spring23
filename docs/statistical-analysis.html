<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Statistical Analysis | Artifex - Spring 2023</title>
  <meta name="description" content="(Partial) course materials for Artifex, Fall 2022." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Statistical Analysis | Artifex - Spring 2023" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="(Partial) course materials for Artifex, Fall 2022." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Statistical Analysis | Artifex - Spring 2023" />
  
  <meta name="twitter:description" content="(Partial) course materials for Artifex, Fall 2022." />
  

<meta name="author" content="David Reynolds" />


<meta name="date" content="2023-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="eda-3---spatial-data.html"/>
<link rel="next" href="other-topics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Artifex Spring 2023</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course Overview - Artifex Spring 2023</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites-and-preparations"><i class="fa fa-check"></i>Prerequisites and Preparations</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="eda-1-traditional-dfs.html"><a href="eda-1-traditional-dfs.html"><i class="fa fa-check"></i><b>1</b> EDA 1 (traditional df’s)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="eda-1-traditional-dfs.html"><a href="eda-1-traditional-dfs.html#from-base-r-to-ggplot2"><i class="fa fa-check"></i><b>1.1</b> From base R to ggplot2</a></li>
<li class="chapter" data-level="1.2" data-path="eda-1-traditional-dfs.html"><a href="eda-1-traditional-dfs.html#linear-regression"><i class="fa fa-check"></i><b>1.2</b> Linear regression</a></li>
<li class="chapter" data-level="1.3" data-path="eda-1-traditional-dfs.html"><a href="eda-1-traditional-dfs.html#assignment-1"><i class="fa fa-check"></i><b>1.3</b> Assignment 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="eda-2---time-series.html"><a href="eda-2---time-series.html"><i class="fa fa-check"></i><b>2</b> EDA 2 - Time Series</a>
<ul>
<li class="chapter" data-level="2.1" data-path="eda-2---time-series.html"><a href="eda-2---time-series.html#coercing-time-variables-to-dates"><i class="fa fa-check"></i><b>2.1</b> Coercing time variables to dates</a></li>
<li class="chapter" data-level="2.2" data-path="eda-2---time-series.html"><a href="eda-2---time-series.html#assignment-2"><i class="fa fa-check"></i><b>2.2</b> Assignment 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html"><i class="fa fa-check"></i><b>3</b> EDA 3 - Spatial Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#joins-and-sf-objects"><i class="fa fa-check"></i><b>3.1</b> Joins and sf objects</a></li>
<li class="chapter" data-level="3.2" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#plotting-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Plotting spatial data</a></li>
<li class="chapter" data-level="3.3" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#assignment-3"><i class="fa fa-check"></i><b>3.3</b> Assignment 3</a></li>
<li class="chapter" data-level="3.4" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#acs-data"><i class="fa fa-check"></i><b>3.4</b> ACS Data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#median-age-by-state"><i class="fa fa-check"></i><b>3.4.1</b> Median age by state</a></li>
<li class="chapter" data-level="3.4.2" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#median-age-within-strafford-county"><i class="fa fa-check"></i><b>3.4.2</b> Median age within Strafford County</a></li>
<li class="chapter" data-level="3.4.3" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#median-home-value-by-county"><i class="fa fa-check"></i><b>3.4.3</b> Median home value by county</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="eda-3---spatial-data.html"><a href="eda-3---spatial-data.html#assignment-4"><i class="fa fa-check"></i><b>3.5</b> Assignment 4</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="statistical-analysis.html"><a href="statistical-analysis.html"><i class="fa fa-check"></i><b>4</b> Statistical Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="statistical-analysis.html"><a href="statistical-analysis.html#time-series"><i class="fa fa-check"></i><b>4.1</b> Time series</a></li>
<li class="chapter" data-level="4.2" data-path="statistical-analysis.html"><a href="statistical-analysis.html#exercise"><i class="fa fa-check"></i><b>4.2</b> Exercise</a></li>
<li class="chapter" data-level="4.3" data-path="statistical-analysis.html"><a href="statistical-analysis.html#spatial-data"><i class="fa fa-check"></i><b>4.3</b> Spatial Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="statistical-analysis.html"><a href="statistical-analysis.html#polygon-data---acs"><i class="fa fa-check"></i><b>4.3.1</b> Polygon data - ACS</a></li>
<li class="chapter" data-level="4.3.2" data-path="statistical-analysis.html"><a href="statistical-analysis.html#point-data"><i class="fa fa-check"></i><b>4.3.2</b> Point data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>5</b> Other Topics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="other-topics.html"><a href="other-topics.html#data-processing"><i class="fa fa-check"></i><b>5.1</b> Data Processing</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="other-topics.html"><a href="other-topics.html#cleaning-up-strings"><i class="fa fa-check"></i><b>5.1.1</b> Cleaning up strings</a></li>
<li class="chapter" data-level="5.1.2" data-path="other-topics.html"><a href="other-topics.html#assignment-1-1"><i class="fa fa-check"></i><b>5.1.2</b> Assignment 1</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="other-topics.html"><a href="other-topics.html#data-manipulation"><i class="fa fa-check"></i><b>5.2</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="other-topics.html"><a href="other-topics.html#filter"><i class="fa fa-check"></i><b>5.2.1</b> Filter</a></li>
<li class="chapter" data-level="5.2.2" data-path="other-topics.html"><a href="other-topics.html#arrange"><i class="fa fa-check"></i><b>5.2.2</b> Arrange</a></li>
<li class="chapter" data-level="5.2.3" data-path="other-topics.html"><a href="other-topics.html#select"><i class="fa fa-check"></i><b>5.2.3</b> Select</a></li>
<li class="chapter" data-level="5.2.4" data-path="other-topics.html"><a href="other-topics.html#mutate"><i class="fa fa-check"></i><b>5.2.4</b> Mutate</a></li>
<li class="chapter" data-level="5.2.5" data-path="other-topics.html"><a href="other-topics.html#group-by-summarise"><i class="fa fa-check"></i><b>5.2.5</b> Group-By/ Summarise</a></li>
<li class="chapter" data-level="5.2.6" data-path="other-topics.html"><a href="other-topics.html#assignment-2-1"><i class="fa fa-check"></i><b>5.2.6</b> Assignment 2</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="other-topics.html"><a href="other-topics.html#time-series-1"><i class="fa fa-check"></i><b>5.3</b> Time Series</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="other-topics.html"><a href="other-topics.html#decomposition"><i class="fa fa-check"></i><b>5.3.1</b> Decomposition</a></li>
<li class="chapter" data-level="5.3.2" data-path="other-topics.html"><a href="other-topics.html#forecasting"><i class="fa fa-check"></i><b>5.3.2</b> Forecasting</a></li>
<li class="chapter" data-level="5.3.3" data-path="other-topics.html"><a href="other-topics.html#statistical-model"><i class="fa fa-check"></i><b>5.3.3</b> Statistical model</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Artifex - Spring 2023</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-analysis" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Statistical Analysis<a href="statistical-analysis.html#statistical-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="time-series" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Time series<a href="statistical-analysis.html#time-series" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A central concept in time series analysis is autocorrelation. This is the correlation between <span class="math inline">\(y_t\)</span> and its lagged value. For a lag of <span class="math inline">\(h\)</span>, this is the correlation between <span class="math inline">\(y_t\)</span> and <span class="math inline">\(y_{t-h}\)</span>. Let’s first review correlation. For two vectors of data, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, the correlation between the two is,</p>
<p><span class="math display">\[\begin{align}
\text{cor}(x,y) &amp;= \frac{\sum_i (x_i - \bar{x})(y_i - \bar{y})}{\sigma_x \sigma_y}
\end{align}\]</span></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="statistical-analysis.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb23-2"><a href="statistical-analysis.html#cb23-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb23-3"><a href="statistical-analysis.html#cb23-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb23-4"><a href="statistical-analysis.html#cb23-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb23-5"><a href="statistical-analysis.html#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="statistical-analysis.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation</span></span>
<span id="cb23-7"><a href="statistical-analysis.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">*</span> (y <span class="sc">-</span> <span class="fu">mean</span>(y)) ) <span class="sc">/</span> ((n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">sd</span>(x) <span class="sc">*</span> <span class="fu">sd</span>(y)) <span class="co"># 0.2789049</span></span>
<span id="cb23-8"><a href="statistical-analysis.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y) <span class="co"># 0.2789049</span></span></code></pre></div>
<p>The autocorrelation takes this concept to a single time series. Autocorrelation, sometimes known as serial correlation in the discrete time case, is the correlation of a signal with a delayed copy of itself as a function of delay. The autocorrelation for a time series <span class="math inline">\(y\)</span> at lag <span class="math inline">\(k\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
r_k = \frac{ \sum_{t = k + 1}^{T} (y_t - \bar{y})(y_{t-k} - \bar{y}) }{\sum_{t=1}^T (y_t - \bar{y})^2 }
\end{equation}\]</span></p>
<p>Here is a simple example of computing a lag 1 autocorrelation.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="statistical-analysis.html#cb24-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb24-2"><a href="statistical-analysis.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="statistical-analysis.html#cb24-3" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb24-4"><a href="statistical-analysis.html#cb24-4" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb24-5"><a href="statistical-analysis.html#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="statistical-analysis.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># lag 1 autocorrelation</span></span>
<span id="cb24-7"><a href="statistical-analysis.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>( (a1 <span class="sc">-</span> <span class="fu">mean</span>(a)) <span class="sc">*</span> (a2 <span class="sc">-</span> <span class="fu">mean</span>(a))) <span class="sc">/</span> (<span class="fu">sum</span>( (a <span class="sc">-</span> <span class="fu">mean</span>(a))<span class="sc">^</span><span class="dv">2</span> ) )  <span class="co"># by hand</span></span>
<span id="cb24-8"><a href="statistical-analysis.html#cb24-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">acf</span>(a))</span></code></pre></div>
<p>This statistic can be found using the <code>acf</code> function. Let’s use the <code>quantmod</code> package to look at the acf of Google’s stock.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="statistical-analysis.html#cb25-1" aria-hidden="true" tabindex="-1"></a>goog <span class="ot">=</span> <span class="fu">getSymbols</span>(<span class="st">&#39;GOOG&#39;</span>, <span class="at">from=</span><span class="st">&#39;2020-10-07&#39;</span>, <span class="at">to=</span><span class="st">&#39;2023-02-10&#39;</span>,<span class="at">auto.assign =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-2"><a href="statistical-analysis.html#cb25-2" aria-hidden="true" tabindex="-1"></a>goog<span class="sc">$</span>diff <span class="ot">=</span> <span class="fu">diff</span>(goog<span class="sc">$</span>GOOG.Close)</span>
<span id="cb25-3"><a href="statistical-analysis.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(goog<span class="sc">$</span>diff)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="statistical-analysis.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(goog<span class="sc">$</span>diff[<span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
</div>
<div id="exercise" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Exercise<a href="statistical-analysis.html#exercise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If your team’s data has a time component(s), explore the ACF of all time series variables as well as their differenced values. What does this tell you?</p>
<p>If your team doesn’t have time indexed data, find a different security from quandl and explore its ACF. How would you explain this? Also, look at the differenced value of the security’s close price and its ACF. Compute the lag 10 autocorrelation “by hand” and check using <code>acf</code></p>

</div>
<div id="spatial-data" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Spatial Data<a href="statistical-analysis.html#spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="polygon-data---acs" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Polygon data - ACS<a href="statistical-analysis.html#polygon-data---acs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Autocorrelation (whether spatial or not) is a measure of similarity (correlation) between nearby observations. In the context of time series, autocorrelation measures the similarity of observations that are nearby in time. The concept of spatial autocorrelation is an extension of this. However, there are some complications. In time, there is only a single dimension to consider when considering the distance between observations. For spatial data, there are many possible ways in which observations may be <em>nearby</em> other observations. One way to measure spatial autocorrelation is a statistic called Moran’s I. To illustrate, I will use ACS data on median home values for counties in New Hampshire. Let us first obtain and visualize this data.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="statistical-analysis.html#cb27-1" aria-hidden="true" tabindex="-1"></a>home_value <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb27-2"><a href="statistical-analysis.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">&quot;county&quot;</span>,</span>
<span id="cb27-3"><a href="statistical-analysis.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">&quot;NH&quot;</span>,</span>
<span id="cb27-4"><a href="statistical-analysis.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">&quot;B25077_001&quot;</span>, <span class="co"># median home value</span></span>
<span id="cb27-5"><a href="statistical-analysis.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">&quot;acs1&quot;</span>,</span>
<span id="cb27-6"><a href="statistical-analysis.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2019</span>,</span>
<span id="cb27-7"><a href="statistical-analysis.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> T</span>
<span id="cb27-8"><a href="statistical-analysis.html#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<table>
<thead>
<tr class="header">
<th align="left">county</th>
<th align="right">num</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Strafford</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Rockingham</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Grafton</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Hillsborough</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Cheshire</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Merrimack</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>The table above shows the mapping of counties to integers. The next step to take is to get a list of neighbors for each county. This is achieved with the function <code>poly2nb</code> (from the package <code>spdep</code> ). As an example, the neighbors of the first county are,</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="statistical-analysis.html#cb28-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(home_value, <span class="at">queen=</span>F)</span>
<span id="cb28-2"><a href="statistical-analysis.html#cb28-2" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">1</span>]] <span class="co"># neighbors of county 1</span></span></code></pre></div>
<pre><code>## [1] 2 6</code></pre>
<p>Next, we need to take these neighbors and give them weights (using the <code>nb2listw</code> function), then use these weights to compute the weighted average of neighbors for each country (using the <code>lag.listw</code> function). See example below,</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="statistical-analysis.html#cb30-1" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style=</span><span class="st">&quot;W&quot;</span>)</span>
<span id="cb30-2"><a href="statistical-analysis.html#cb30-2" aria-hidden="true" tabindex="-1"></a>inc.lag <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, home_value<span class="sc">$</span>estimate)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="statistical-analysis.html#cb31-1" aria-hidden="true" tabindex="-1"></a>moransi.df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">neighbors =</span> inc.lag, <span class="at">observations =</span> home_value<span class="sc">$</span>estimate)</span>
<span id="cb31-2"><a href="statistical-analysis.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="statistical-analysis.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moransi.df, <span class="fu">aes</span>(<span class="at">x=</span> observations, <span class="at">y =</span> neighbors)) <span class="sc">+</span> </span>
<span id="cb31-4"><a href="statistical-analysis.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb31-5"><a href="statistical-analysis.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> </span>
<span id="cb31-6"><a href="statistical-analysis.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Morans I plot&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>The Moran’s I is the slope of this regression line. In this case, -0.06. This can also be computed as,</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="statistical-analysis.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(neighbors <span class="sc">~</span> observations, <span class="at">data =</span> moransi.df) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="statistical-analysis.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="statistical-analysis.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">2.957523e+05</td>
<td align="right">4.543672e+04</td>
<td align="right">6.5091039</td>
<td align="right">0.0028750</td>
</tr>
<tr class="even">
<td align="left">observations</td>
<td align="right">-6.096390e-02</td>
<td align="right">1.680815e-01</td>
<td align="right">-0.3627043</td>
<td align="right">0.7351786</td>
</tr>
</tbody>
</table>
</div>
<div id="point-data" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Point data<a href="statistical-analysis.html#point-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="eda-3---spatial-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="other-topics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dbreynol/artifex_fall2022/edit/master/statistical_analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
