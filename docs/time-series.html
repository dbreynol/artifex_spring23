<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Time Series | Artifex - Fall 2022</title>
  <meta name="description" content="(Partial) course materials for Artifex, Fall 2022." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Time Series | Artifex - Fall 2022" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="(Partial) course materials for Artifex, Fall 2022." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Time Series | Artifex - Fall 2022" />
  
  <meta name="twitter:description" content="(Partial) course materials for Artifex, Fall 2022." />
  

<meta name="author" content="David Reynolds" />


<meta name="date" content="2022-11-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-manipulation.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Artifex Fall 2022</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course Overview - Artifex Fall 2022</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites-and-preparations"><i class="fa fa-check"></i>Prerequisites and Preparations</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>1</b> Data Processing</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-processing.html"><a href="data-processing.html#cleaning-up-strings"><i class="fa fa-check"></i><b>1.1</b> Cleaning up strings</a></li>
<li class="chapter" data-level="1.2" data-path="data-processing.html"><a href="data-processing.html#assignment-1"><i class="fa fa-check"></i><b>1.2</b> Assignment 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-manipulation.html"><a href="data-manipulation.html#filter"><i class="fa fa-check"></i><b>2.1</b> Filter</a></li>
<li class="chapter" data-level="2.2" data-path="data-manipulation.html"><a href="data-manipulation.html#arrange"><i class="fa fa-check"></i><b>2.2</b> Arrange</a></li>
<li class="chapter" data-level="2.3" data-path="data-manipulation.html"><a href="data-manipulation.html#select"><i class="fa fa-check"></i><b>2.3</b> Select</a></li>
<li class="chapter" data-level="2.4" data-path="data-manipulation.html"><a href="data-manipulation.html#mutate"><i class="fa fa-check"></i><b>2.4</b> Mutate</a></li>
<li class="chapter" data-level="2.5" data-path="data-manipulation.html"><a href="data-manipulation.html#group-by-summarise"><i class="fa fa-check"></i><b>2.5</b> Group-By/ Summarise</a></li>
<li class="chapter" data-level="2.6" data-path="data-manipulation.html"><a href="data-manipulation.html#assignment-2"><i class="fa fa-check"></i><b>2.6</b> Assignment 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>3</b> Time Series</a>
<ul>
<li class="chapter" data-level="3.1" data-path="time-series.html"><a href="time-series.html#decomposition"><i class="fa fa-check"></i><b>3.1</b> Decomposition</a></li>
<li class="chapter" data-level="3.2" data-path="time-series.html"><a href="time-series.html#forecasting"><i class="fa fa-check"></i><b>3.2</b> Forecasting</a></li>
<li class="chapter" data-level="3.3" data-path="time-series.html"><a href="time-series.html#statistical-model"><i class="fa fa-check"></i><b>3.3</b> Statistical model</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Artifex - Fall 2022</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Time Series<a href="time-series.html#time-series" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="decomposition" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Decomposition<a href="time-series.html#decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We want to decompose our time series into three parts: a trend component (<span class="math inline">\(T\)</span>), a seasonality component (<span class="math inline">\(S\)</span>), and a random component (<span class="math inline">\(R\)</span>). That is, for each observation <span class="math inline">\(Y_t\)</span>, we want to break it down into three parts:</p>
<p><span class="math inline">\(Y_T = T_t + S_t + R_t\)</span></p>
<p>First, let’s talk about the trend component (T). The trend component is a moving average, which you can obtain using the <code>ma</code> function within the <em>forecast</em> library.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="time-series.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb13-2"><a href="time-series.html#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="time-series.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate some fake data that resembles our real dataset (noce the week_no variable, which </span></span>
<span id="cb13-4"><a href="time-series.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># corresponds with the enterprise week number from your original data)</span></span>
<span id="cb13-5"><a href="time-series.html#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="time-series.html#cb13-6" aria-hidden="true" tabindex="-1"></a>trend <span class="ot">=</span> <span class="fu">seq</span>( <span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">10</span> <span class="sc">+</span> <span class="dv">52</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">-</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb13-7"><a href="time-series.html#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="time-series.html#cb13-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>( <span class="at">invoiced =</span> trend <span class="sc">+</span> (<span class="fu">rnorm</span>(<span class="dv">52</span> <span class="sc">*</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">40</span>)), </span>
<span id="cb13-9"><a href="time-series.html#cb13-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">week_no =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">52</span>, <span class="dv">3</span>), <span class="co"># week number</span></span>
<span id="cb13-10"><a href="time-series.html#cb13-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>(<span class="dv">52</span> <span class="sc">*</span> <span class="dv">3</span>)) </span>
<span id="cb13-11"><a href="time-series.html#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>invoiced, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="time-series.html#cb14-1" aria-hidden="true" tabindex="-1"></a>y_ts <span class="ot">=</span> <span class="fu">ts</span>(df<span class="sc">$</span>invoiced, <span class="at">frequency =</span> <span class="dv">52</span>) <span class="co"># make your data into a time series object</span></span>
<span id="cb14-2"><a href="time-series.html#cb14-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>trend <span class="ot">=</span> <span class="fu">ma</span>(y_ts, <span class="at">order =</span> <span class="dv">52</span>) <span class="co"># use the ma function from the forecast library</span></span></code></pre></div>
<p>Now that we have added a trend variable to our data frame, let’s get the seasonal (<span class="math inline">\(S\)</span>) component. To estimate the seasonal component for each week, simply average the detrended values for that week. These seasonal component values are then adjusted to ensure that they add to zero.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="time-series.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. subtract the trend</span></span>
<span id="cb15-2"><a href="time-series.html#cb15-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>detrend <span class="ot">=</span> df<span class="sc">$</span>invoiced <span class="sc">-</span> df<span class="sc">$</span>trend</span>
<span id="cb15-3"><a href="time-series.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="time-series.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. group by week number and take the average of the de-trended values</span></span>
<span id="cb15-5"><a href="time-series.html#cb15-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(week_no) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="time-series.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">S1 =</span> <span class="fu">mean</span>(detrend, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="time-series.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="time-series.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">S =</span> S1 <span class="sc">-</span> <span class="fu">mean</span>(S1)) <span class="sc">%&gt;%</span> <span class="co"># make sure the sum of the seasonal components is 0</span></span>
<span id="cb15-9"><a href="time-series.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(detrend, S1))</span></code></pre></div>
<p>Finally, the random component is calculated by subtracting the estimated seasonal and trend-cycle components. That is,</p>
<p><span class="math inline">\(R_t = Y_t - T_t - S_t\)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="time-series.html#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">mutate</span>(df, <span class="at">R =</span> invoiced <span class="sc">-</span> trend <span class="sc">-</span> S)</span></code></pre></div>
<p>Now, plot each line:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="time-series.html#cb17-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="time-series.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>(<span class="fu">c</span>(<span class="st">&quot;week_no&quot;</span>, <span class="st">&quot;id&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="time-series.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(id, value, <span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb17-4"><a href="time-series.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb17-5"><a href="time-series.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb17-6"><a href="time-series.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Decomposition of invoiced time series&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="forecasting" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Forecasting<a href="time-series.html#forecasting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s consider some very simple potential forecast models. The simplest potential model is to forecast future values as the last observed value. That is,</p>
<p><span class="math display">\[\begin{equation}
\hat{y}_{T+1 | T} = y_T
\end{equation}\]</span></p>
<p>Another very simple model consists of forecasting future values as the average over the entire observed series. That is,</p>
<p><span class="math display">\[\begin{equation}
\hat{y}_{T+1 | T} = \frac{1}{T} \sum_{i=1}^T y_i
\end{equation}\]</span></p>
<p>A slightly more complicated approach that typically works better is to forecast future values as a weighted average of past values, with higher weights assigned to more recent observations. This model can be expressed as,</p>
<p><span class="math display">\[\begin{equation}
\hat{y}_{T+h | T} = \alpha y_T + (1-\alpha) \hat{y}_{T | T - 1}
\end{equation}\]</span></p>
<p>How can we show that weights are decreasing in time? What does this expression imply about forecasts from this model? This is implemented in <code>ses</code> below.</p>
<p>The next level up in complexity is using the same idea but adding a trend estimate. In this case, the forecast values are,</p>
<p><span class="math display">\[\begin{equation}
\hat{y}_{T+h | T} = l_T + h b_T,
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(l\)</span> is the estimated level of the time series and <span class="math inline">\(b_T\)</span> is the estimated trend at time <span class="math inline">\(T\)</span>. What does this expression imply about forecasts from this model? This is implemented in <code>holt</code> below.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="time-series.html#cb18-1" aria-hidden="true" tabindex="-1"></a>fx1 <span class="ot">&lt;-</span> <span class="fu">ses</span>(y_ts, <span class="at">h=</span><span class="dv">5</span>)</span>
<span id="cb18-2"><a href="time-series.html#cb18-2" aria-hidden="true" tabindex="-1"></a>fx2 <span class="ot">&lt;-</span> <span class="fu">holt</span>(y_ts, <span class="at">h=</span><span class="dv">15</span>)</span>
<span id="cb18-3"><a href="time-series.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="time-series.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">accuracy</span>(fx1),<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                ME  RMSE   MAE    MPE  MAPE MASE  ACF1
## Training set 6.46 37.15 28.71 -21.53 55.35 0.56 -0.08</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="time-series.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(y_ts) <span class="sc">+</span></span>
<span id="cb20-2"><a href="time-series.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(fx1, <span class="at">series=</span><span class="st">&quot;Simple Exponential Smoothing&quot;</span>, <span class="at">PI=</span>F) <span class="sc">+</span></span>
<span id="cb20-3"><a href="time-series.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(fx2, <span class="at">series=</span><span class="st">&quot;Holt Winters&quot;</span>, <span class="at">PI=</span>F) <span class="sc">+</span> </span>
<span id="cb20-4"><a href="time-series.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Invoiced&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="statistical-model" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Statistical model<a href="time-series.html#statistical-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the drawbacks of the forecasting methods we have used so far is that there is no uncertainty quantification. Fortunately, there is an easy way to formulate the exponential smoothing models we have been working with as a statistical model. For more detail, <a href="https://otexts.com/fpp2/ets.html">see this excellent resource</a>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="time-series.html#cb21-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">ets</span>(y_ts, <span class="at">model=</span><span class="st">&quot;ZZZ&quot;</span>, <span class="at">damped=</span><span class="cn">NULL</span>, <span class="at">alpha=</span><span class="cn">NULL</span>, <span class="at">beta=</span><span class="cn">NULL</span>,</span>
<span id="cb21-2"><a href="time-series.html#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">gamma=</span><span class="cn">NULL</span>, <span class="at">phi=</span><span class="cn">NULL</span>, <span class="at">lambda=</span><span class="cn">NULL</span>, <span class="at">biasadj=</span><span class="cn">FALSE</span>,</span>
<span id="cb21-3"><a href="time-series.html#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">additive.only=</span><span class="cn">FALSE</span>, <span class="at">restrict=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-4"><a href="time-series.html#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">allow.multiplicative.trend=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Once the model is fit, we can see which model was chosen using the <code>summary</code> function. We label each state space model as ETS( <span class="math inline">\(\cdot, \cdot, \cdot\)</span>), for (Error, Trend, Seasonal). The possibilities for each component are: Error = {<span class="math inline">\(A,M\)</span>}, Trend = {<span class="math inline">\(N,A,A_d\)</span>}, and Seasonal = {<span class="math inline">\(N,A,M\)</span>}. Here, <span class="math inline">\(M\)</span> denotes multiply and <span class="math inline">\(A\)</span> denotes add. In an <span class="math inline">\(M\)</span> type model, the component multiplies (i.e., a season in which invoices are 1.1 times as large).</p>
<pre><code>## ETS(A,A,N) 
## 
## Call:
##  ets(y = y_ts, model = &quot;ZZZ&quot;, damped = NULL, alpha = NULL, beta = NULL,  
## 
##  Call:
##      gamma = NULL, phi = NULL, additive.only = FALSE, lambda = NULL,  
## 
##  Call:
##      biasadj = FALSE, restrict = TRUE, allow.multiplicative.trend = FALSE) 
## 
##   Smoothing parameters:
##     alpha = 0.002 
##     beta  = 0.002 
## 
##   Initial states:
##     l = 30.6217 
##     b = 1.054 
## 
##   sigma:  35.968
## 
##      AIC     AICc      BIC 
## 1911.506 1911.906 1926.755 
## 
## Training set error measures:
##                     ME     RMSE     MAE       MPE     MAPE     MASE        ACF1
## Training set -2.913354 35.50392 28.2599 -29.14288 55.95159 0.552141 -0.03601155</code></pre>
<p>There is also a straightforward way to forecast using the fitted model.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="time-series.html#cb23-1" aria-hidden="true" tabindex="-1"></a>mod <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p><strong>To do</strong></p>
<ol style="list-style-type: decimal">
<li>Cut your time series into a training set (all but the last 3 months of data) and a test set (last 3 months)</li>
<li>Fit a state-space model using <code>ETS</code> to your (weekly) time series. What model was chosen? Compare forecasts for 12 weeks ahead to the actual data.</li>
<li>Now make your training set and test set into monthly data and repeat step 2.</li>
<li>On a monthly basis, how do the residuals of the weekly model compare to the residuals of the monthly model?</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-manipulation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dbreynol/artifex_fall2022/edit/master/write.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
